{"version":3,"file":"AutoComplete.stories-04181d7a.js","sources":["../../src/hooks/useDebounce.tsx","../../src/hooks/useClickOutside.tsx","../../src/components/AutoComplete/AutoComplete.tsx","../../src/components/AutoComplete/const/index.ts"],"sourcesContent":["import { useEffect, useState } from 'react';\n\nfunction useDebounce<T = unknown>(value: T, delay = 200) {\n\tconst [debounceValue, setDebounceValue] = useState(value);\n\n\tuseEffect(() => {\n\t\tconst handler = setTimeout(() => {\n\t\t\tsetDebounceValue(value);\n\t\t}, delay);\n\n\t\treturn () => clearTimeout(handler);\n\t}, [value, delay, debounceValue]);\n\n\treturn debounceValue;\n}\n\nexport default useDebounce;\n","import { useEffect, RefObject } from 'react';\n\nfunction useClickOutside(ref: RefObject<HTMLElement>, handler: Function) {\n\tuseEffect(() => {\n\t\tconst listener = (e: MouseEvent) => {\n\t\t\tif (!ref.current || ref.current.contains(e.target as HTMLElement)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\thandler(e);\n\t\t};\n\t\tdocument.addEventListener('click', listener);\n\n\t\treturn () => document.removeEventListener('click', listener);\n\t}, [ref, handler]);\n}\n\nexport default useClickOutside;\n","import React, {\n\tuseState,\n\tuseEffect,\n\tChangeEvent,\n\tKeyboardEvent,\n\tuseRef\n} from 'react';\nimport Input, { InputProps } from '../Input';\nimport Icon from '../Icon';\nimport { useDebounce, useClickOutside } from '../../hooks';\nimport { classNames } from '../../utils';\nimport Transition from '../Transition';\n\nexport interface DataSourceType {\n\tvalue: string;\n}\n\nexport interface AutoCompleteProps<T> extends Omit<InputProps, 'onSelect'> {\n\tfetchSuggestions: (str: string) => T[] | Promise<T[]>;\n\tonSelect?: (item: T) => void;\n\trenderOption?: (item: T) => React.ReactElement;\n}\n\nfunction AutoComplete<T extends DataSourceType>(props: AutoCompleteProps<T>) {\n\tconst { value, renderOption, fetchSuggestions, onSelect, ...restProps } =\n\t\tprops;\n\tconst [inputValue, setInputValue] = useState(value as string);\n\tconst [suggestions, setSuggestions] = useState<T[]>([]);\n\tconst [loading, setLoading] = useState(false);\n\tconst [highlightIndex, setHightlightIndex] = useState(-1);\n\tconst isPromise = useRef(true);\n\tconst debounceValue = useDebounce(inputValue, isPromise.current ? 500 : 0);\n\tconst triggerSearch = useRef(false);\n\tconst componentRef = useRef<HTMLDivElement>(null);\n\tconst nodeRef = useRef(null);\n\n\tuseClickOutside(componentRef, () => setSuggestions([]));\n\n\tuseEffect(() => {\n\t\tif (debounceValue && triggerSearch.current) {\n\t\t\tconst result = fetchSuggestions(debounceValue);\n\n\t\t\tisPromise.current = result instanceof Promise;\n\t\t\tif (result instanceof Promise) {\n\t\t\t\tresult.then((data) => {\n\t\t\t\t\tsetSuggestions(data);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tsetSuggestions(result);\n\t\t\t}\n\t\t} else {\n\t\t\tsetSuggestions([]);\n\t\t}\n\t\tsetHightlightIndex(-1);\n\t\tsetLoading(false);\n\t}, [debounceValue, fetchSuggestions]);\n\n\tconst handleChange = (e: ChangeEvent<HTMLInputElement>) => {\n\t\ttriggerSearch.current = true;\n\t\tsetInputValue(e.target.value.trim());\n\t\tsetLoading(true);\n\t};\n\n\tconst highlight = (index: number) => {\n\t\tif (index < 0) index = 0;\n\t\tif (index >= suggestions.length) index = suggestions.length - 1;\n\t\tsetHightlightIndex(index);\n\t};\n\n\tconst handleKeyDown = (e: KeyboardEvent<HTMLInputElement>) => {\n\t\tswitch (e.key) {\n\t\t\tcase 'ArrowUp':\n\t\t\t\te.preventDefault();\n\t\t\t\thighlight(highlightIndex - 1);\n\t\t\t\tbreak;\n\t\t\tcase 'ArrowDown':\n\t\t\t\te.preventDefault();\n\t\t\t\thighlight(highlightIndex + 1);\n\t\t\t\tbreak;\n\t\t\tcase 'Escape':\n\t\t\t\tsetSuggestions([]);\n\t\t\t\tbreak;\n\t\t\tcase 'Enter':\n\t\t\t\tif (suggestions[highlightIndex]) {\n\t\t\t\t\thandleSelect(suggestions[highlightIndex]);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t}\n\t};\n\n\tconst handleSelect = (item: T) => {\n\t\ttriggerSearch.current = false;\n\t\tsetInputValue(item.value);\n\t\tsetSuggestions([]);\n\t\tif (onSelect) onSelect(item);\n\t};\n\n\tconst handleHover = (index: number) => {\n\t\tif (index !== highlightIndex) {\n\t\t\tsetHightlightIndex(index);\n\t\t}\n\t};\n\n\tconst renderTemplate = (item: T) => (\n\t\t<>{renderOption ? renderOption(item) : item.value}</>\n\t);\n\n\tconst generateDropdown = () =>\n\t\tsuggestions.map((item, index) => {\n\t\t\tconst classes = classNames('ac__suggestion__item', {\n\t\t\t\t'ac__suggestion__item-hightlighted': index === highlightIndex\n\t\t\t});\n\t\t\treturn (\n\t\t\t\t<li\n\t\t\t\t\tkey={index}\n\t\t\t\t\tdata-key={index}\n\t\t\t\t\tclassName={classes}\n\t\t\t\t\tonClick={() => handleSelect(item)}\n\t\t\t\t\tonMouseMove={() => handleHover(index)}\n\t\t\t\t>\n\t\t\t\t\t{renderTemplate(item)}\n\t\t\t\t</li>\n\t\t\t);\n\t\t});\n\n\treturn (\n\t\t<div className=\"ac\" ref={componentRef} data-testid=\"test-auto-complete\">\n\t\t\t<Input\n\t\t\t\tclassName=\"ac__input\"\n\t\t\t\tvalue={inputValue}\n\t\t\t\tonChange={handleChange}\n\t\t\t\tonKeyDown={handleKeyDown}\n\t\t\t\t{...restProps}\n\t\t\t/>\n\t\t\t<Transition\n\t\t\t\tnodeRef={nodeRef}\n\t\t\t\tin={suggestions.length > 0}\n\t\t\t\ttimeout={300}\n\t\t\t\tanimationName=\"zoom-in-top\"\n\t\t\t>\n\t\t\t\t<ul ref={nodeRef} className=\"ac__suggestion\">\n\t\t\t\t\t{loading ? (\n\t\t\t\t\t\t<li className=\"ac__suggestion__loading\">\n\t\t\t\t\t\t\t<Icon icon=\"FaSpinner\" theme=\"primary\" spin />\n\t\t\t\t\t\t</li>\n\t\t\t\t\t) : (\n\t\t\t\t\t\tgenerateDropdown()\n\t\t\t\t\t)}\n\t\t\t\t</ul>\n\t\t\t</Transition>\n\t\t</div>\n\t);\n}\n\nexport default AutoComplete;\n","export const chineseZodiac = [\n\t{ value: 'Rat', chineseName: '鼠' },\n\t{ value: 'Ox', chineseName: '牛' },\n\t{ value: 'Tiger', chineseName: '虎' },\n\t{ value: 'Rabbit', chineseName: '兔' },\n\t{ value: 'Dragon', chineseName: '龍' },\n\t{ value: 'Snake', chineseName: '蛇' },\n\t{ value: 'Horse', chineseName: '馬' },\n\t{ value: 'Goat', chineseName: '羊' },\n\t{ value: 'Monkey', chineseName: '猴' },\n\t{ value: 'Rooster', chineseName: '雞' },\n\t{ value: 'Dog', chineseName: '狗' },\n\t{ value: 'Pig', chineseName: '豬' }\n];\n\nexport type IChineseZodiac = typeof chineseZodiac[0];\nexport type IGithubUser = {\n\tlogin: string;\n\tavatar_url: string;\n};\n\nexport function testFetchSuggestions(str: string) {\n\treturn chineseZodiac.filter((zodiac) =>\n\t\tzodiac.value.toLowerCase().includes(str.toLowerCase())\n\t);\n}\nexport function testAsyncFetchSuggestions(str: string) {\n\treturn fetch(`https://api.github.com/search/users?q=${str}`)\n\t\t.then((res) => res.json())\n\t\t.then(({ items }) =>\n\t\t\tArray.isArray(items)\n\t\t\t\t? items.slice(0, 10).map((item: IGithubUser) => ({\n\t\t\t\t\t\tvalue: item.login,\n\t\t\t\t\t\t...item\n\t\t\t\t  }))\n\t\t\t\t: []\n\t\t)\n\t\t.catch(() => []);\n}\n"],"names":["useDebounce","value","delay","debounceValue","setDebounceValue","useState","useEffect","handler","setTimeout","clearTimeout","useClickOutside","ref","listener","__name","e","current","contains","target","addEventListener","document","removeEventListener","AutoComplete","props","renderOption","fetchSuggestions","onSelect","restProps","inputValue","setInputValue","suggestions","setSuggestions","loading","setLoading","highlightIndex","setHightlightIndex","isPromise","useRef","triggerSearch","componentRef","nodeRef","result","handleChange","highlight","index","handleKeyDown","handleSelect","item","handleHover","renderTemplate","_jsx","_Fragment","generateDropdown","classes","classNames","_jsxs","Input","Icon","chineseZodiac","testFetchSuggestions","str","zodiac","testAsyncFetchSuggestions","res","items"],"mappings":"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"}